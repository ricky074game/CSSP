new function(){if(window.localStorage!=null){let session_expires=parseFloat($("#session_expires").attr("data-expires"));if(session_expires!=null){const session_warning=300,session_expires_obj=$("#session_expires"),session_service_extend=session_expires_obj.attr("data-service-extend"),session_service_login=session_expires_obj.attr("data-service-login"),session_service_check=session_expires_obj.attr("data-service-check"),session_realm=session_expires_obj.attr("data-realm"),session_drift=parseFloat(session_expires_obj.attr("data-now"))-Date.now()/1e3;let session_updated=Date.now()/1e3,session_interval=null,session_timeout=null;const sessionExtend=function(){$.ajax({url:session_service_extend,success:function(data){session_expires=parseFloat(data);session_updated=Date.now()/1e3;localStorage.setItem("session_"+session_realm+"/expires",session_expires.toString());sessionInit()},error:function(){alert("Unable to extend session. You may attempt to log in again.");$("#sessionExtendDialog button.default").off("click").on("click",sessionLogin).text("Login")}})},sessionLogin=function(){window.open(session_service_login,window.Capacitor?"_self":"_blank")},sessionInterval=function(){const session_remaining=$("#sessionExtendDialog #session_remaining");session_remaining.length==0&&(clearInterval(session_interval),session_interval=null);const session_expires_in=session_expires-sessionNow();session_expires_in>60?session_remaining.text("This session will expire in "+Math.ceil(session_expires_in/60).toString()+" minutes."):session_expires_in>0?session_remaining.text("This session will expire in 1 minute."):(session_remaining.text("This session has expired."),$("#sessionExtendDialog button.default").off("click").on("click",sessionLogin).text("Login"),clearInterval(session_interval),session_interval=null)},sessionMonitor=function(){const session_expires_in=session_expires-sessionNow();if(!document.hidden&&Date.now()/1e3-session_updated>300)$.ajax({url:session_service_check,success:function(data){session_expires=parseFloat(data);session_updated=Date.now()/1e3;localStorage.setItem("session_"+session_realm+"/expires",session_expires.toString());sessionMonitor()}});else if(session_expires_in<session_warning){var dialog=$('<div class="dialog" id="sessionExtendDialog" style="width: 350px;"><div class="content" style="padding: 25px; text-align: center;"><div id="session_remaining">This session will expire in 5 minutes.<\/div><div style="margin-top: 25px;"><button class="default" type="button">Extend<\/button><\/div><\/div><\/div>');dialog.find("button.default").on("click",sessionExtend);session_interval!=null&&clearInterval(session_interval);session_interval=setInterval(sessionInterval,5e3);FW.Dialog.Load(dialog,{stack:!0,cancel:!1});sessionInterval()}},sessionNow=function(){return Date.now()/1e3+session_drift},sessionInit=function(){const session_expires_in=session_expires-sessionNow(),sessionStorageMonitor=function(event){event.key=="session_"+session_realm+"/expires"&&(session_expires=parseFloat(event.newValue)||0,session_updated=Date.now()/1e3,sessionInit())};if(session_timeout==null){if(localStorage.setItem("session_"+session_realm+"/expires",session_expires),session_expires==0)return;window.addEventListener("storage",sessionStorageMonitor);FW.loginHandler=function(){session_expires=0;session_updated=0;sessionMonitor()}}session_timeout!=null&&clearTimeout(session_timeout);session_timeout=setTimeout(sessionMonitor,session_expires_in>session_warning?(session_expires_in-session_warning)*1e3:0);session_expires_in>session_warning&&$("#sessionExtendDialog").length>0&&FW.Dialog.Unload();window.addEventListener("session_expired",function(){session_timeout!=null&&clearTimeout(session_timeout);window.removeEventListener("storage",sessionStorageMonitor)})};sessionInit()}}};